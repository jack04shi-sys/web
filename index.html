<!DOCTYPE html> <html lang="zh-CN"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>Coze Agent è¯­éŸ³è¾“å…¥ç‰ˆ</title> <style> body { font-family: system-ui, Arial, sans-serif; margin: 0; padding: 12px; } h3 { margin: 6px 0 12px; } .toolbar { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; margin-bottom: 10px; } button, select { padding: 8px 12px; cursor: pointer; } #sttResult { min-height: 28px; padding: 8px 10px; background: #f5f5f7; border-radius: 6px; } iframe { width: 100%; height: 72vh; border: 0; } .status { font-size: 12px; color: #666; } .warn { color: #b45309; background: #fff7ed; padding: 6px 8px; border-radius: 6px; margin-bottom: 8px; display: none; } </style> </head> <body> <h3>Coze Agent è¯­éŸ³è¾“å…¥</h3> <div id="httpsWarn" class="warn">æç¤ºï¼šè¯­éŸ³è¯†åˆ«éœ€è¦åœ¨ HTTPS é¡µé¢ä¸Šä½¿ç”¨ã€‚è¯·éƒ¨ç½²åˆ° GitHub Pages/Netlify/Vercel ç­‰ HTTPS åŸŸååå†è¯•ã€‚</div> <div class="toolbar"> <button id="micBtn">ğŸ¤ å¼€å§‹è¯­éŸ³è¾“å…¥</button> <button id="stopBtn">â¹ï¸ åœæ­¢</button> <button id="copyBtn">ğŸ“‹ å¤åˆ¶è¯†åˆ«æ–‡æœ¬</button> <select id="langSel" title="è¯†åˆ«è¯­è¨€"> <option value="zh-CN" selected>ä¸­æ–‡(ç®€ä½“)</option> <option value="zh-TW">ä¸­æ–‡(ç¹é«”)</option> <option value="en-US">English (US)</option> </select> <span class="status" id="status">çŠ¶æ€ï¼šå¾…æœº</span> <button id="openBtn">ğŸ¡• æ–°çª—å£æ‰“å¼€ Agent</button> </div> <div id="sttResult">è¯†åˆ«ç»“æœä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ</div> <iframe id="cozeFrame" src="https://www.coze.com/store/agent/7573652690762366981?bot_id=true" allow="microphone" style="width:100%;height:72vh;border:0"></iframe> <script> // HTTPS æç¤º if (location.protocol !== 'https:' && location.hostname !== 'localhost') { document.getElementById('httpsWarn').style.display = 'block'; } const agentURL = "https://www.coze.com/store/agent/7573652690762366981?bot_id=true"; const statusEl = document.getElementById('status'); const micBtn = document.getElementById('micBtn'); const stopBtn = document.getElementById('stopBtn'); const copyBtn = document.getElementById('copyBtn'); const langSel = document.getElementById('langSel'); const sttResultEl = document.getElementById('sttResult'); document.getElementById('openBtn').addEventListener('click', () => window.open(agentURL, '_blank')); const SR = window.SpeechRecognition || window.webkitSpeechRecognition; let rec = null; let recognizing = false; async function ensureMicPermission() { if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) return true; // ä¸€äº›ç¯å¢ƒæ— æ­¤ APIï¼Œä½† SR å¯èƒ½ä»å¯ç”¨ try { await navigator.mediaDevices.getUserMedia({ audio: true }); return true; } catch (e) { const msg = e && (e.name || e.message) || 'æœªçŸ¥é”™è¯¯'; alert('è·å–éº¦å…‹é£å¤±è´¥ï¼š' + msg + 'ã€‚è¯·æ£€æŸ¥æµè§ˆå™¨åœ°å€æ æƒé™ä¸ç³»ç»Ÿè®¾ç½®ã€‚'); return false; } } function initSR() { if (!SR) { statusEl.textContent = 'çŠ¶æ€ï¼šå½“å‰æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«ï¼ˆå»ºè®®ç”¨ PC çš„ Chrome/Edge æœ€æ–°ç‰ˆï¼‰ã€‚'; micBtn.disabled = true; stopBtn.disabled = true; return false; } rec = new SR(); rec.lang = langSel.value; rec.interimResults = false; rec.maxAlternatives = 1; rec.onstart = () => { recognizing = true; statusEl.textContent = 'çŠ¶æ€ï¼šæ­£åœ¨è¯†åˆ«ï¼ˆè¯·è¯´è¯â€¦ï¼‰'; sttResultEl.textContent = 'è¯†åˆ«ä¸­â€¦'; }; rec.onresult = (e) => { const text = e.results?.[0]?.[0]?.transcript || ''; sttResultEl.textContent = text ? ('è¯†åˆ«ç»“æœï¼š' + text) : 'æœªè¯†åˆ«åˆ°æœ‰æ•ˆè¯­éŸ³ï¼Œè¯·é‡è¯•'; statusEl.textContent = 'çŠ¶æ€ï¼šè¯†åˆ«å®Œæˆ'; }; rec.onerror = (err) => { recognizing = false; const code = err?.error || err?.name || err?.message || 'æœªçŸ¥é”™è¯¯'; statusEl.textContent = 'çŠ¶æ€ï¼šé”™è¯¯ - ' + code; if (code === 'not-allowed' || code === 'service-not-allowed') { alert('éº¦å…‹é£æƒé™è¢«æ‹’ç»ã€‚è¯·åœ¨åœ°å€æ å³ä¾§æˆäºˆéº¦å…‹é£æƒé™å¹¶åˆ·æ–°é¡µé¢ã€‚'); } else if (code === 'no-speech') { // æ²¡æœ‰æ£€æµ‹åˆ°è¯­éŸ³ï¼Œä¸å¼¹çª— } else if (code === 'aborted') { // ä¸»åŠ¨åœæ­¢ } else { console.error('Speech error:', err); alert('è¯­éŸ³è¯†åˆ«å‡ºé”™ï¼š' + code); } }; rec.onend = () => { recognizing = false; if (!statusEl.textContent.includes('è¯†åˆ«å®Œæˆ') && !statusEl.textContent.includes('å·²åœæ­¢')) { statusEl.textContent = 'çŠ¶æ€ï¼šå¾…æœº'; } }; return true; } micBtn.addEventListener('click', async () => { const ok = await ensureMicPermission(); if (ok === false) return; if (!rec && !initSR()) return; if (recognizing) return; // é¿å…é‡å¤ start try { rec.lang = langSel.value; rec.start(); } catch (e) { console.warn('rec.start error:', e); } }); stopBtn.addEventListener('click', () => { if (!rec) return; try { rec.stop(); } catch (e) {} statusEl.textContent = 'çŠ¶æ€ï¼šå·²åœæ­¢'; }); langSel.addEventListener('change', () => { if (rec && !recognizing) rec.lang = langSel.value; }); copyBtn.addEventListener('click', async () => { const text = (sttResultEl.textContent || '').replace(/^è¯†åˆ«ç»“æœï¼š/, ''); if (!text || text === 'è¯†åˆ«ä¸­â€¦' || text === 'è¯†åˆ«ç»“æœä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ') { alert('æ²¡æœ‰å¯å¤åˆ¶çš„è¯†åˆ«æ–‡æœ¬'); return; } try { await navigator.clipboard.writeText(text); alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œè¯·ç²˜è´´åˆ°èŠå¤©è¾“å…¥æ¡†å‘é€'); } catch { try { const ta = document.createElement('textarea'); ta.value = text; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta); alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œè¯·ç²˜è´´åˆ°èŠå¤©è¾“å…¥æ¡†å‘é€'); } catch { alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰ä¸­æ–‡æœ¬å¤åˆ¶ï¼š' + text); } } }); </script> </body> </html>
